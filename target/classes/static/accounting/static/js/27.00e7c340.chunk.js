(this["webpackJsonpportal-react"]=this["webpackJsonpportal-react"]||[]).push([[27],{1302:function(e,t,a){"use strict";t.a={SIGNBORDRO:{code:0},SIGNMIME:{code:1},RESENDMIME:{code:2}}},1311:function(e,t,a){"use strict";var s=a(0),i=a.n(s),r=a(19),o=a(13),n=a.n(o),l=(a(218),a(9)),d=a.n(l),c=(a(82),a(6)),p=a.n(c),m=a(1302),h=a(3),u=a(5),g=a(12),y=a(46),S=a(74);class b extends s.Component{constructor(e){super(e),this.getEmployeeId=async()=>{let e=this,t={url:"/employee/getEmployeeId/"+this.state.content[0].employee.id,method:"post"};try{let a=await Object(u.e)(t);e.setState({employeeUserId:a.data})}catch(a){Object(h.v)(a),e.setState({loading:!1})}},this.getApprovalUserId=async()=>{let e=this,t={url:"/approval/getApprovalUserId/"+this.state.content[0].id,method:"post"};try{let a=await Object(u.e)(t);e.setState({approvalUserId:a.data})}catch(a){Object(h.v)(a),e.setState({loading:!1})}},this.state={loading:!1,alert:null,selection:[],manual:!1,content:[],total:0,page:0,size:10},this.fetchData=this.fetchData.bind(this),this.previewBordro=this.previewBordro.bind(this),this.setMediaViewer=this.setMediaViewer.bind(this)}fetchData(e,t,a,s){let r=this,o=void 0!==e?"&sort="+e+","+t:"",l={url:"/bordro/readBordroAllByIds?processCode="+r.props.processCode+"&page="+a+"&size="+s+o,method:"post",data:r.props.selectedBordroIdList};r.setState({loading:!0,searching:!0,manual:!0!==r.manual&&r.manual}),Object(u.e)(l).then((async function(e){let t=r.props.bordroSession&&r.props.bordroSession.id;if(e.data.page&&0===e.data.page.totalElements)r.setState({alert:i.a.createElement(n.a,{error:!0,confirmBtnText:"Tamam",confirmBtnBsStyle:"danger",title:"Hata",onConfirm:()=>{t?r.props.history.push({pathname:`/${r.props.peykName}/bordroimport/`+t}):r.setState({alert:null}),r.props.toggleModal&&r.props.toggleModal(!0)}},r.props.processCode===m.a.RESENDMIME.code&&"Se\xe7ilen al\u0131c\u0131lar\u0131n onayda bekleyen g\xf6nderileri bulunmamaktad\u0131r.",r.props.processCode===m.a.SIGNBORDRO.code&&"Se\xe7ilen \xfccret bordrolar\u0131n\u0131n imzal\u0131 iletiler bulundu\u011fu veya \xe7al\u0131\u015fan e\u015fle\u015fmesi yap\u0131lmam\u0131\u015f oldu\u011fu i\xe7in bu i\u015flem yap\u0131lamaz.",r.props.processCode===m.a.SIGNMIME.code&&"Se\xe7ilen \xfccret bordrolar\u0131n\u0131n imzal\u0131 iletiler bulundu\u011fu veya \xe7al\u0131\u015fan e\u015fle\u015fmesi yap\u0131lmam\u0131\u015f oldu\u011fu i\xe7in bu i\u015flem yap\u0131lamaz."),loading:!1});else{if(e.data.page&&e.data.page.totalElements<r.props.selectedBordroIdList.length){r.props.toggleModal(!1);let e=r.props.processCode===m.a.RESENDMIME.code?"Tekrar g\xf6nderime haz\u0131r bordrolar se\xe7ilmi\u015ftir.":(r.props.processCode,m.a.SIGNBORDRO.code,"\xc7al\u0131\u015fan e\u015fle\u015fmesi olmayanlar ve daha \xf6nce g\xf6nderilmi\u015f bordro listeden \xe7\u0131kar\u0131lm\u0131\u015ft\u0131r.");p.a.warning(e,{position:"top-right",effect:"stackslide",timeout:8e3})}r.setState({page:a,size:s,total:e.data.page&&e.data.page.totalElements,content:e.data.page&&e.data.page.content,loading:!1},()=>{"FLOW_TIMEOUT"===e.data.page.content[0].state&&r.props.updateFlowTimeout(!0),r.props.onComplete(e.data.selectedIdList)}),"FLOW_TIMEOUT"===e.data.page.content[0].state&&(await r.getEmployeeId(),await r.getApprovalUserId(),r.state.approvalUserId===r.state.employeeUserId?r.props.readFlowTimeoutTemplate():r.props.readTimeoutTemplate())}})).catch((function(e){r.setState({loading:!1}),Object(h.v)(e)}))}setMediaViewer(){this.setState({url:null,mediaModal:!1})}previewBordro(e){let t=this,a={url:"/bordro/previewBordroContent",responseType:"arraybuffer",method:"post",data:e.id};t.setState({mediaModal:!0}),Object(u.e)(a).then((function(e){let a=new Blob([e.data],{type:e.headers["content-type"]}),s="";if(void 0!=a){let e=new FileReader;e.readAsDataURL(a),e.onloadend=function(){s=e.result,t.setState({url:s})}}})).catch((function(e){Object(h.v)(e),t.setState({mediaModal:!1})}))}render(){let e=[{Header:"D\xf6nem",accessor:"term",Cell:e=>i.a.createElement("div",null,!!e.term&&d()(e.term,"YYYY/MM/DD").format("YYYY/MM"))},{Header:"TCKN",accessor:"parsedTckn",Cell:e=>i.a.createElement("div",null,e.employee&&e.employee.name&&i.a.createElement("span",{className:"text-success"},e.parsedTckn),!(e.employee&&e.employee.name)&&i.a.createElement("span",{className:"text-danger"},e.parsedTckn))},{Header:"Ad\u0131",accessor:"employee_name",Cell:e=>i.a.createElement("div",null,e.employee&&e.employee.name)},{Header:"Soyad\u0131",accessor:"employee_surname",Cell:e=>i.a.createElement("div",null,e.employee&&e.employee.surname)},{Header:"Kep Adresi",accessor:"employee_kepAddress",Cell:e=>i.a.createElement("div",null,e.employee&&e.employee.kepAddress)},{Header:"Uyar\u0131 Say\u0131s\u0131",accessor:"warningCount",Cell:e=>i.a.createElement("div",{style:{margin:0}},e.warningCount)},{Header:"Durumu",accessor:"state",Cell:e=>i.a.createElement("div",null,e.error&&i.a.createElement("span",{className:"text-danger"},e.error),!e.error&&i.a.createElement("span",{className:"text-"+y.a[e.state].messageType},y.a[e.state].message))},{Header:"\u0130\u015flemler",sortable:!1,accessor:"",Cell:e=>i.a.createElement("div",{style:{textAlign:"left"}},i.a.createElement("button",{title:"\xdccret Bordrosu G\xf6r\xfcnt\xfcle",className:"btn-icon btn btn-info btn-sm",style:{margin:"0px 3px"},onClick:t=>this.previewBordro(e)},i.a.createElement("i",{className:"now-ui-icons ui-1_zoom-bold"})))}],t=Object(g.H)(e,"accessor",this.props.isKepOwner);return i.a.createElement("div",null,this.state.mediaModal&&i.a.createElement(S.a,{modal:this.state.mediaModal,url:this.state.url,title:"\xdccret Bordrosu",listener:this.setMediaViewer,closeModal:this.setMediaViewer}),i.a.createElement(r.a,{columns:t,content:this.state.content,loading:this.props.loading?this.props.loading:this.state.loading,total:this.state.total,page:this.state.page,manual:this.state.manual,size:this.state.size,options:["5","10","20","50","100"],fetchData:this.fetchData}),this.state.alert)}}t.a=b},1475:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),r=a(2),o=(a(92),a(13)),n=a.n(o),l=a(62),d=a.n(l),c=(a(218),a(82),a(60)),p=a.n(c),m=a(80),h=a(175),u=a(1311),g=a(38),y=a.n(g),S=a(21),b=a(1302),f=a(3),E=a(5),I=a(9),C=a.n(I);class v extends s.Component{constructor(e){super(e),this.state={loading:!1,completed:!1,signedDocumentCount:0,progressLength:1,pageState:0,selectedBordroIdList:[],timer:1,timerStarted:!1,certError:!0},this.signMimes=this.signMimes.bind(this),this.updateMimeInfo=this.updateMimeInfo.bind(this),this.writeSignedMime=this.writeSignedMime.bind(this),this.updateMimeCertificates=this.updateMimeCertificates.bind(this),this.stateMap={0:{label:"\u0130letiler imzalama i\xe7in haz\u0131r. \u0130mzalay\u0131n\u0131z"},10:{label:"\u0130letiler olu\u015fturuluyor. L\xfctfen bekleyiniz.",wait:!0},20:{label:"Sertifika sahibi iletilere yaz\u0131l\u0131yor. L\xfctfen bekleyiniz.",wait:!0},30:{label:"\u0130letiler imzalan\u0131yor. L\xfctfen bekleyiniz"},40:{label:"\u0130letiler imzalanamad\u0131. L\xfctfen bilgileri kontrol ediniz.",danger:!0}}}componentDidMount(){if(this.axios=p.a.create({baseURL:"http://127.0.0.1:9999"}),this.props&&this.props.location&&this.props.location.bordroSession){let e=this,t={url:"/signer/readKepActiveAll",method:"post"};Object(E.e)(t).then((function(t){let a=t.data;e.setState({kepAccountList:a})})).catch((function(t){Object(f.v)(t),e.setState({loading:!1,createUpdateLoading:!1})})),e.setState({selectedBordroIdList:e.props.location.selectedBordroIdList});let a=["Ocak","\u015eubat","Mart","Nisan","May\u0131s","Haziran","Temmuz","A\u011fustos","Eyl\xfcl","Ekim","Kas\u0131m","Aral\u0131k"],s=C()(e.props.location.bordroSession.term,"YYYY/MM/DD").format("YYYY"),i=C()(e.props.location.bordroSession.term,"YYYY/MM/DD").format("M");e.setState({mimeTitle:`${a[i-1]} ${s} \xdccret Pusulas\u0131 Bildirimi`}),e.setState({mimeBody:"4857 Say\u0131l\u0131 \u0130\u015f Kanunu 37. ve 109. maddeleri h\xfckm\xfcnce i\u015fveren taraf\u0131ndan haz\u0131rlanan \xfccret pusulas\u0131 KEP ekinde taraf\u0131n\u0131za tebli\u011f edilmi\u015ftir. "+a[i-1]+" "+s+" d\xf6nemine ili\u015fkin \xfccret pusulas\u0131na kar\u015f\u0131 itirazlar\u0131n\u0131z\u0131n KEP marifeti ile taraf\u0131m\u0131za bildirilmesi, aksi halde \xfccret pusulas\u0131n\u0131n kesinle\u015fece\u011fini ihtar ve ihbar ederiz."})}else this.props.history.push({pathname:`/${this.props.peykName}/bordrosessionlist`})}componentDidUpdate(){1===this.state.timer&&!this.state.timerStarted&&this.state.completed&&this.state.signedDocumentCount===this.state.progressLength?(setInterval(()=>{this.setState(e=>({timer:e.timer-1}))},1e3),this.setState({timerStarted:!0})):0===this.state.timer&&this.props.history.push({pathname:`/${this.props.peykName}/bordroimport/`+this.props.location.bordroSession.id})}updateMimeInfo(){let e=this,t=e.state.selectedBordroIdList?e.state.selectedBordroIdList:e.props.location.selectedBordroIdList,a={url:"/signer/writeMimeInfo",method:"post",data:{bordroSessionId:e.props.location.bordroSession.id,kepAccountId:parseInt(e.state.kepAccountId),title:e.state.mimeTitle,body:e.state.mimeBody,selectedBordros:t}};e.setState({selectedBordroIdList:t,pageState:10,alert:null}),Object(E.e)(a).then((function(t){e.updateMimeCertificates()})).catch((function(t){Object(f.v)(t),e.setState({pageState:40})}))}updateMimeCertificates(){let e=this,t=e.props.location.bordroSession.id,a=e.state.mimeCertificate.hsmType,s={url:"/signer/createMimeSignedInfoList",method:"post",data:{certificate:e.state.mimeCertificate.value,bordroSessionId:t,hsmType:a,certificateKeyId:e.state.mimeCertificate.keyId,bordroIdList:e.state.selectedBordroIdList}};e.setState({pageState:20}),Object(E.e)(s).then((function(t){e.setState({signedInfoList:t.data}),e.signMimes()})).catch((function(t){Object(f.v)(t),e.setState({pageState:40})}))}signMimes(){let e=Promise.resolve([]),t=[];this.setState({progressLength:this.state.signedInfoList.length,loading:!0,pageState:30}),this.state.signedInfoList.forEach((a,s)=>{e=e.then(e=>(this.setState({bordroName:a.bordroName}),this.axios.post("/signature/signedinfo?hsmtype="+a.hsmType,{base64:!0,pin:this.state.pin,signedInfo:a.signedInfo,certificate:{keyId:a.certificateKeyId}}).then(e=>{t.push({id:a.id,signature:e.data.signedDocument}),this.writeSignedMime(t),t=[]})))}),e.then(e=>{this.setState({loading:!1,completed:!0})}).catch(e=>{this.setState({loading:!1,completed:!0,alert:i.a.createElement(m.a,{error:e,onConfirm:()=>this.setState({alert:null})})})})}writeSignedMime(e){let t=this,a={url:"/signer/writeMimeSignature",method:"post",data:e};Object(E.e)(a).then((function(e){t.setState((e,t)=>({signedDocumentCount:e.signedDocumentCount+1}))})).catch((function(e){Object(f.v)(e),t.setState({pageState:40})}))}renderNavButtons(){return i.a.createElement(r.Nav,{className:"topbar",style:{paddingLeft:"14px",height:"53px"}},i.a.createElement(S.a,{position:"leftSide",className:"zocial GeriDon",style:{fontSize:"small"},label:"Geri",title:"\xd6nceki Sayfaya Git",onClick:e=>this.props.history.push({pathname:`/${this.props.peykName}/bordroimport/`+this.props.location.bordroSession.id,selectedBordroIdList:this.props.location.selectedBordroIdList})}),i.a.createElement(S.a,{position:"leftSide",className:"zocial Imza",style:{fontSize:"small"},label:"\u0130mzala",title:"\u0130leti Olu\u015ftur ve \u0130mzala",onClick:e=>{this.state.mimeCertificate&&this.state.mimeCertificate.hsmType&&this.state.mimeCertificate.value&&this.state.mimeCertificate.keyId?void 0===this.state.kepAccountId?this.setState({alert:i.a.createElement(n.a,{warning:!0,confirmBtnText:"Tamam",confirmBtnBsStyle:"warning",title:"Uyar\u0131",onConfirm:()=>{this.setState({alert:null})}},"Kep hesab\u0131 se\xe7imi yap\u0131n\u0131z.")}):this.setState({alert:i.a.createElement(n.a,{showCancel:!0,warning:!0,confirmBtnText:"Evet",cancelBtnText:"Hay\u0131r",confirmBtnBsStyle:"danger",cancelBtnBsStyle:"default",title:"Emin misiniz?",onConfirm:this.updateMimeInfo,onCancel:()=>this.setState({alert:null})},"\u0130letiler imzalanacak.")}):this.setState({alert:i.a.createElement(m.a,{error:this.state.certError,onConfirm:()=>this.setState({alert:null})})})}}))}renderState(){let e=this.stateMap[this.state.pageState];return i.a.createElement("div",{className:"row",style:{marginBottom:"15px"}},i.a.createElement(r.Col,{sm:12},i.a.createElement("div",{style:{display:"inline-block",marginRight:"8px"}},e.wait&&i.a.createElement(y.a,{type:"balls",color:"#2c2c2c",height:24,width:24})),i.a.createElement("div",{style:{display:"inline-block",marginRight:"8px",position:"relative",top:"-6px",color:!0===e.danger?"trueColor":"falseColor"}},e.label)))}renderMimeInputs(){return i.a.createElement("div",{className:"FormRenk"},i.a.createElement(r.Row,{sm:6},i.a.createElement(r.Col,{sm:2,style:{top:"7px"}},"Kep Hesab\u0131"),i.a.createElement(r.Col,{sm:6},this.state.kepAccountList&&i.a.createElement(r.Input,{type:"select",value:this.state.kepAccountId,disabled:0!==this.state.pageState,onChange:e=>this.setState({kepAccountId:e.target.value})},[i.a.createElement("option",{key:"0",value:""},"Se\xe7iniz"),...this.state.kepAccountList.map(e=>i.a.createElement("option",{key:e.id,value:e.id},e.account))]),!this.state.kepAccountList&&i.a.createElement(r.Input,{type:"select",value:this.state.kepAccountId,onChange:e=>this.setState({kepAccountId:e.target.value})},[i.a.createElement("option",{key:"0",value:""},"Se\xe7iniz")]))),i.a.createElement(r.Row,{sm:6},i.a.createElement(r.Col,{sm:2,style:{top:"5px"}},"Kep Konu"),i.a.createElement(r.Col,{sm:6},i.a.createElement(r.Input,{type:"text",style:{marginTop:"2px"},disabled:0!==this.state.pageState,value:this.state.mimeTitle,onChange:e=>this.setState({mimeTitle:e.target.value})}))),i.a.createElement(r.Row,{sm:6},i.a.createElement(r.Col,{sm:2,style:{top:"25px"}},"Kep \u0130\xe7erik"),i.a.createElement(r.Col,{sm:6},i.a.createElement(r.Input,{type:"textarea",rows:5,disabled:0!==this.state.pageState,style:{height:"200px",border:"1px solid #E3E3E3",marginTop:"2px",padding:"3px 3px"},value:this.state.mimeBody,onChange:e=>this.setState({mimeBody:e.target.value})}))))}renderBordroList(){return i.a.createElement(u.a,{bordroSession:this.props.location.bordroSession,selectedBordroIdList:this.props.location.selectedBordroIdList,onComplete:e=>this.setState({selectedBordroIdList:e}),pageSize:10,history:this.props.history,peykName:this.props.peykName,processCode:b.a.SIGNMIME.code})}render(){return i.a.createElement(r.Row,{className:"baseBackground"},i.a.createElement(d.a,{ref:"notify"}),this.state.alert,this.renderNavButtons(),i.a.createElement("div",{className:"row satirBasi"},i.a.createElement(r.Col,{md:"12"},i.a.createElement(r.Card,{className:"card"},i.a.createElement(r.CardHeader,null,i.a.createElement(r.CardTitle,{tag:"h4"},"\u0130mzala & G\xf6nder")),i.a.createElement(r.CardBody,null,this.props.location.bordroSession&&this.renderState()),i.a.createElement(r.CardBody,null,this.props.location.bordroSession&&this.renderMimeInputs()),i.a.createElement(r.CardBody,null,this.props.location.bordroSession&&i.a.createElement(h.a,{sessionId:this.props.location.bordroSession.id,value:this.state.mimeCertificate,onChange:e=>this.setState({mimeCertificate:e}),pinValueChange:e=>this.setState({pin:e}),certificateError:e=>this.setState({certError:e}),pdfName:this.state.bordroName?this.state.bordroName:"",progressLength:this.state.progressLength,signedDocumentCount:this.state.signedDocumentCount,displayCertificateMenu:0===this.state.pageState||40===this.state.pageState,userId:this.props.currentUser&&this.props.currentUser.id})),i.a.createElement(r.CardBody,null,this.props.location.bordroSession&&this.renderBordroList())))))}}t.default=v}}]);
//# sourceMappingURL=27.00e7c340.chunk.js.map