(this["webpackJsonpportal-react"]=this["webpackJsonpportal-react"]||[]).push([[49],{1496:function(t,e,a){"use strict";a.r(e);var i=a(0),s=a.n(i),n=a(2),r=(a(92),a(13)),o=a.n(r),l=a(62),m=a.n(l),d=(a(218),a(82),a(60)),c=a.n(d),p=a(80),h=a(175),f=a(38),u=a.n(f),g=a(21),S=a(5),y=a(3),E=a(4),b=a(6),C=a.n(b);class I extends i.Component{constructor(t){super(t),this.readSmsTemplate=()=>{let t=this,e={url:"/signer/readFormSmsTemplateInfo",method:"get"};Object(S.e)(e).then((function(e){t.setState({smsBody:e.data})})).catch((function(t){Object(y.v)(t)}))},this.readMailTemplate=()=>{let t=this,e={url:"/signer/readFormMailTemplateInfo",method:"get"};Object(S.e)(e).then((function(e){e.data&&t.setState({mimeBody:e.data})})).catch((function(t){Object(y.v)(t)}))},this.isNoTemplateValid=()=>""===this.state.mimeTitle.trim()?(C.a.error("E-Posta \u0130leti Konusu alan\u0131 bo\u015f b\u0131rak\u0131lamaz.",{position:"top-right",effect:"stackslide",timeout:5e3}),this.setState({alert:null}),!1):""===this.state.mimeBody.trim()?(C.a.error("E-Posta \u0130leti \u0130\xe7eri\u011fi alan\u0131 bo\u015f b\u0131rak\u0131lamaz.",{position:"top-right",effect:"stackslide",timeout:5e3}),this.setState({alert:null}),!1):""!==this.state.smsBody.trim()||(C.a.error("SMS \u0130leti \u0130\xe7eri\u011fi alan\u0131 bo\u015f b\u0131rak\u0131lamaz.",{position:"top-right",effect:"stackslide",timeout:5e3}),this.setState({alert:null}),!1),this.state={loading:!1,completed:!1,signedDocumentCount:0,progressLength:1,pageState:0,timer:1,timerStarted:!1,certError:!0,disableButton:!1},this.signPdf=this.signPdf.bind(this),this.writeSignedForm=this.writeSignedForm.bind(this),this.updatePdfCertificates=this.updatePdfCertificates.bind(this),this.stateMap={0:{label:"Form dosyalar\u0131 imzalama i\xe7in haz\u0131r. \u0130mzalay\u0131n\u0131z"},10:{label:"\u0130letiler olu\u015fturuluyor. L\xfctfen bekleyiniz.",wait:!0},20:{label:"Sertifika sahibi formlara yaz\u0131l\u0131yor. L\xfctfen, sayfay\u0131 terk etmeyiniz.",wait:!0},30:{label:"Form dosyalar\u0131 imzalan\u0131yor. L\xfctfen, sayfay\u0131 terk etmeyiniz."},40:{label:"Formlar imzalanamad\u0131. Bilgileri kontrol ediniz.",danger:!0}}}componentDidMount(){this.axios=c.a.create({baseURL:"http://127.0.0.1:9999"}),this.props&&this.props.location&&this.props.location.formSessionId?(this.setState({formSessionId:this.props.location.formSessionId,mimeTitle:this.props.location.mimeTitle,mimeBody:this.props.location.mimeBody}),this.readSmsTemplate(),this.readMailTemplate()):this.props.history.push({pathname:`/${this.props.peykName}/formsessionlist`})}componentDidUpdate(){1===this.state.timer&&!this.state.timerStarted&&this.state.completed&&this.state.signedDocumentCount===this.state.progressLength?(setInterval(()=>{this.setState(t=>({timer:t.timer-1}))},1e3),this.setState({timerStarted:!0})):0===this.state.timer&&this.props.history.push({pathname:`/${this.props.peykName}/formsession/`+this.state.formSessionId})}updateMailInfo(){let t=this,e={url:"/signer/writeFormMimeInfo",method:"post",data:{formSessionId:parseInt(t.props.location.formSessionId),kepAccountId:t.state.kepAccountId&&parseInt(t.state.kepAccountId),title:t.state.mimeTitle,body:t.state.mimeBody,smsBody:t.state.smsBody}};t.setState({pageState:10,alert:null,disableButton:!0}),Object(S.e)(e).then((function(e){t.updatePdfCertificates()})).catch((function(e){Object(y.v)(e),t.setState({pageState:40,disableButton:!1})}))}timerStatus(t){this.props.onTimerStatus(t)}updatePdfCertificates(){let t=this,e={url:"/signer/createFormPdfSignedInfoList",method:"post",data:{formSessionId:parseInt(t.state.formSessionId),hsmType:t.state.pdfCertificate.hsmType,certificate:t.state.pdfCertificate.value,certificateKeyId:t.state.pdfCertificate.keyId,pdfCertificate:JSON.stringify(t.state.pdfCertificate)},timeout:96e5};this.setState({pageState:20,alert:null}),this.timerStatus(!0),Object(S.e)(e).then((function(e){t.setState({signedInfoList:e.data}),t.signPdf()})).catch((function(e){Object(y.v)(e),t.setState({pageState:40,disableButton:!1}),this.timerStatus(!1)}))}signPdf(){let t=Promise.resolve([]),e=[];this.setState({progressLength:this.state.signedInfoList.length,loading:!0,pageState:30}),this.state.signedInfoList.forEach((a,i)=>{t=t.then(t=>(this.setState({pdfName:a.pdfName}),this.axios.post("/signature/signedinfo?hsmtype="+a.hsmType,{base64:!0,pin:this.state.pin,signedInfo:a.signedInfo,certificate:{keyId:a.certificateKeyId}}).then(t=>{e.push({id:a.id,signature:t.data.signedDocument}),this.writeSignedForm(e),e=[]})))}),t.then(t=>{this.setState({loading:!1,completed:!0})}).catch(t=>{this.setState({loading:!1,completed:!1,pageState:0,disableButton:!1,alert:s.a.createElement(p.a,{error:t,onConfirm:()=>this.setState({alert:null})})})})}writeSignedForm(t){let e=this,a={url:"/signer/writeFormPdfSignature",method:"post",data:t,timeout:96e5};Object(S.e)(a).then((function(t){e.setState((t,e)=>({signedDocumentCount:t.signedDocumentCount+1}))})).catch((function(t){Object(y.v)(t),e.setState({pageState:40,disableButton:!1}),this.timerStatus(!1)}))}renderNavButtons(){return s.a.createElement(n.Nav,{className:"topbar",style:{paddingLeft:"14px",height:"53px"}},s.a.createElement(g.a,{position:"leftSide",className:"zocial GeriDon",style:{fontSize:"x-small"},label:"Geri",title:"\xd6nceki Sayfaya Git",onClick:()=>this.props.history.push(`/${this.props.peykName}/formsession/${this.state.formSessionId}`)}),(Object(y.f)(this,E.w)||Object(y.f)(this,E.E)||Object(y.f)(this,E.B)||Object(y.f)(this,E.U)||Object(y.f)(this,E.G))&&s.a.createElement(g.a,{position:"leftSide",className:"zocial Imza",style:{fontSize:"x-small"},label:"\u0130mzala",title:"Form PDF Dosyalar\u0131 \u0130mzala",disabled:this.state.disableButton,onClick:t=>{this.state.pdfCertificate&&this.state.pdfCertificate.hsmType&&this.state.pdfCertificate.value&&this.state.pdfCertificate.keyId?this.setState({alert:s.a.createElement(o.a,{showCancel:!0,warning:!0,confirmBtnText:"Evet",cancelBtnText:"Hay\u0131r",confirmBtnBsStyle:"success",cancelBtnBsStyle:"default",title:"Emin misiniz?",onConfirm:()=>{this.isNoTemplateValid()&&this.updateMailInfo()},onCancel:()=>this.setState({alert:null})},"Dok\xfcmanlar imzalan\u0131p T\xfcbitak zaman damgas\u0131 ile m\xfch\xfcrlenerek g\xf6nderilecektir.")}):this.setState({alert:s.a.createElement(p.a,{error:this.state.certError,onConfirm:()=>this.setState({alert:null})})})}}))}renderState(){let t=this.stateMap[this.state.pageState];return s.a.createElement("div",{className:"row",style:{marginBottom:"15px"}},s.a.createElement(n.Col,{sm:"12",md:"6"},s.a.createElement("div",{style:{display:"inline-block",marginRight:"8px"}},t.wait&&s.a.createElement(u.a,{type:"balls",color:"#2c2c2c",height:24,width:24})),s.a.createElement("div",{style:{display:"inline-block",marginRight:"8px",position:"relative",top:"-6px",color:!0===t.danger?"trueColor":"falseColor"}},t.label)),s.a.createElement(n.Col,{sm:"12",md:"6"},s.a.createElement("div",{className:"explanationOfSigning",style:{lineHeight:"1.2"}},s.a.createElement("i",{className:"fas fa-exclamation-triangle",id:"exclamationIcon",style:{paddingRight:"10px"}}),s.a.createElement("span",{style:{opacity:"0.9",fontSize:"12px",fontWeight:"500"}},"\u0130mzalama s\xfcresince l\xfctfen ekran\u0131 kapatmay\u0131n\u0131z ve bilgisayar\u0131n\u0131z\u0131n ekran koruyucusunun kapal\u0131 oldu\u011fundan emin olun."))))}renderMailInputs(){return s.a.createElement("div",{className:"FormRenk"},s.a.createElement(n.Row,{sm:6},s.a.createElement(n.Col,{sm:2,style:{top:"5px"}},"E-Posta Konu"),s.a.createElement(n.Col,{sm:6},s.a.createElement(n.Input,{type:"text",style:{marginTop:"2px"},value:this.state.mimeTitle,onChange:t=>this.setState({mimeTitle:t.target.value})}))),s.a.createElement(n.Row,{sm:6},s.a.createElement(n.Col,{sm:2,style:{top:"25px"}},"E-Posta \u0130\xe7erik"),s.a.createElement(n.Col,{sm:6},s.a.createElement(n.Input,{type:"textarea",rows:5,style:{height:"200px",border:"1px solid #E3E3E3",marginTop:"2px",padding:"3px 3px"},value:this.state.mimeBody,onChange:t=>this.setState({mimeBody:t.target.value})}))),s.a.createElement(n.Row,{sm:6},s.a.createElement(n.Col,{sm:2,style:{top:"25px"}},"SMS \u0130\xe7erik"),s.a.createElement(n.Col,{sm:6},s.a.createElement(n.Input,{type:"textarea",rows:5,style:{height:"200px",border:"1px solid #E3E3E3",marginTop:"2px",padding:"3px 3px"},value:this.state.smsBody,onChange:t=>this.setState({smsBody:t.target.value})}))))}render(){return s.a.createElement(n.Row,{className:"baseBackground"},s.a.createElement(m.a,{ref:"notify"}),this.state.alert,this.renderNavButtons(),s.a.createElement("div",{className:"row satirBasi"},s.a.createElement(n.Col,{md:"12"},s.a.createElement(n.Card,{className:"card"},s.a.createElement(n.CardHeader,null,s.a.createElement(n.CardTitle,{tag:"h4"},"\u0130mzala & G\xf6nder")),s.a.createElement(n.CardBody,null,this.props.location.formSessionId&&this.renderState()),s.a.createElement(n.CardBody,null,this.props.location.formSessionId&&this.renderMailInputs()),s.a.createElement(n.CardBody,null,this.props.location.formSessionId&&s.a.createElement(h.a,{manual:!0,value:this.state.pdfCertificate,onChange:t=>this.setState({pdfCertificate:t}),pinValueChange:t=>this.setState({pin:t}),certificateError:t=>this.setState({certError:t}),pdfName:this.state.pdfName?this.state.pdfName:"",progressLength:this.state.progressLength,signedDocumentCount:this.state.signedDocumentCount,displayCertificateMenu:0===this.state.pageState||40===this.state.pageState,userId:this.props.currentUser&&this.props.currentUser.id}))))))}}e.default=I}}]);
//# sourceMappingURL=49.25aa0023.chunk.js.map