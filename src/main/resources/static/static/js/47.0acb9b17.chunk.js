(this["webpackJsonpportal-react"]=this["webpackJsonpportal-react"]||[]).push([[47],{1593:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),l=a(2),n=(a(93),a(63)),r=a.n(n),o=(a(220),a(83),a(81)),m=a(38),c=a.n(m),d=a(21),h=a(5),p=a(3),u=a(13),g=a.n(u),f=a(6),y=a.n(f),E=a(4);class S extends s.Component{constructor(e){super(e),this.readSmsTemplate=()=>{let e=this;Object(h.e)({url:"/signer/readFormSmsTemplateInfo",method:"get"}).then((function(t){e.setState({smsBody:t.data})})).catch((function(e){Object(p.v)(e)}))},this.isNoTemplateValid=()=>""===this.state.mimeTitle.trim()?(y.a.error("E-Posta \u0130leti Konusu alan\u0131 bo\u015f b\u0131rak\u0131lamaz...",{position:"top-right",effect:"stackslide",timeout:5e3}),this.setState({alert:null}),!1):""===this.state.mimeBody.trim()?(y.a.error("E-Posta \u0130leti \u0130\xe7eri\u011fi alan\u0131 bo\u015f b\u0131rak\u0131lamaz.",{position:"top-right",effect:"stackslide",timeout:5e3}),this.setState({alert:null}),!1):""!==this.state.smsBody.trim()||(y.a.error("SMS \u0130leti \u0130\xe7eri\u011fi alan\u0131 bo\u015f b\u0131rak\u0131lamaz.",{position:"top-right",effect:"stackslide",timeout:5e3}),this.setState({alert:null}),!1),this.state={loading:!1,completed:!1,signedDocumentCount:0,progressLength:1,pageStatus:0,timer:1,timerStarted:!1,certError:!0,selectedIdList:[],disableButton:!1},this.sign=this.sign.bind(this),this.signDocuments=this.signDocuments.bind(this),this.updateMimeInfo=this.updateMimeInfo.bind(this),this.stateMap={0:{label:"Pdf dosyalar\u0131 imzalama i\xe7in haz\u0131r. \u0130mzalay\u0131n\u0131z"},10:{label:"\u0130letiler olu\u015fturuluyor. L\xfctfen bekleyiniz.",wait:!0},30:{label:"Pdf dosyalar\u0131 imzalan\u0131yor. L\xfctfen bekleyiniz"},40:{label:"Pdf dosyalar\u0131 imzalanamad\u0131. L\xfctfen bilgileri kontrol ediniz.",danger:!0},50:{label:"Pdf dosyalar\u0131 imzaland\u0131."},60:{label:""}}}componentWillMount(){this.setState({formSessionId:this.props.location.formSessionId,kepAccountList:this.props.location.kepAccountList,mimeTitle:this.props.location.mimeTitle,mimeBody:this.props.location.mimeBody,selectedIdList:this.props.location.selectedIdList}),this.readSmsTemplate()}componentDidUpdate(){1===this.state.timer&&!this.state.timerStarted&&this.state.completed&&this.state.signedDocumentCount===this.state.progressLength?(setInterval(()=>{this.setState(e=>({timer:e.timer-1}))},4e3),this.setState({timerStarted:!0})):0===this.state.timer&&this.setState({backToTheFuture:!0}),this.state.backToTheFuture&&this.props.history.push({pathname:"/".concat(this.props.peykName,"/formsession/")+this.state.formSessionId})}sign(){this.isNoTemplateValid()&&this.updateMimeInfo()}updateMimeInfo(){let e=this,t={url:"/signer/writeFormMimeInfo",method:"post",data:{formSessionId:parseInt(e.props.location.formSessionId),title:e.state.mimeTitle,body:e.state.mimeBody,smsBody:e.state.smsBody},timeout:96e5};e.setState({pageStatus:10,alert:null,disableButton:!0}),Object(h.e)(t).then((function(t){e.signDocuments()})).catch((function(t){Object(p.v)(t),e.setState({pageStatus:40,disableButton:!1})}))}timerStatus(e){this.props.onTimerStatus(e)}signDocuments(){this.setState({progressLength:this.state.selectedIdList.length,loading:!0,pageStatus:30}),this.timerStatus(!0),Object(h.e)({url:"/signer/hsm-sign-form-list",method:"post",data:this.state.selectedIdList}).then(e=>{y.a.success(e.data),this.stateMap[60].label=e.data,this.setState({loading:!1,completed:!0,pageStatus:60}),setInterval(()=>{this.setState({backToTheFuture:!0})},2e3)}).catch(e=>{this.setState({loading:!1,completed:!0,pageStatus:40,disableButton:!1,alert:i.a.createElement(o.a,{error:e,onConfirm:()=>this.setState({alert:null})})}),this.timerStatus(!1)})}renderNavButtons(){return i.a.createElement(l.Nav,{className:"topbar",style:{paddingLeft:"14px",height:"53px"}},i.a.createElement(d.a,{position:"leftSide",className:"zocial GeriDon",style:{fontSize:"small"},label:"Geri",title:"\xd6nceki Sayfaya Git",onClick:()=>this.props.history.push({pathname:"/".concat(this.props.peykName,"/formsession/").concat(this.state.formSessionId)})}),(Object(p.f)(this,E.w)||Object(p.f)(this,E.C)||Object(p.f)(this,E.E)||Object(p.f)(this,E.B)||Object(p.f)(this,E.U)||Object(p.f)(this,E.G))&&i.a.createElement(d.a,{position:"leftSide",className:"zocial Imza",style:{fontSize:"small"},label:"\u0130mzala",title:"Formlar\u0131 \u0130mzala",disabled:this.state.disableButton,onClick:()=>{this.setState({alert:i.a.createElement(g.a,{showCancel:!0,warning:!0,confirmBtnText:"Evet",cancelBtnText:"Hay\u0131r",confirmBtnBsStyle:"success",cancelBtnBsStyle:"default",title:"Emin Misiniz?",onConfirm:()=>this.sign(),onCancel:()=>this.setState({alert:null})},"Dok\xfcmanlar imzalan\u0131p T\xfcbitak zaman damgas\u0131 ile m\xfch\xfcrlenerek g\xf6nderilecektir.")})}}))}renderState(){let e=this.stateMap[this.state.pageStatus];return i.a.createElement("div",{className:"row",style:{marginBottom:"15px"}},i.a.createElement(l.Col,{sm:12},i.a.createElement("div",{style:{display:"inline-block",marginRight:"8px"}},e.wait&&i.a.createElement(c.a,{type:"balls",color:"#2c2c2c",height:24,width:24})),i.a.createElement("div",{style:{display:"inline-block",marginRight:"8px",position:"relative",top:"-6px",color:!0===e.danger?"trueColor":"falseColor"}},e.label)))}renderMimeInputs(){return i.a.createElement("div",{className:"FormRenk"},i.a.createElement(l.Row,{sm:6},i.a.createElement(l.Col,{sm:2,style:{top:"5px"}},"E-Posta Konu"),i.a.createElement(l.Col,{sm:6},i.a.createElement(l.Input,{type:"text",style:{marginTop:"2px"},value:this.state.mimeTitle,onChange:e=>this.setState({mimeTitle:e.target.value})}))),i.a.createElement(l.Row,{sm:6},i.a.createElement(l.Col,{sm:2,style:{top:"25px"}},"E-Posta \u0130\xe7erik"),i.a.createElement(l.Col,{sm:6},i.a.createElement(l.Input,{type:"textarea",rows:5,style:{height:"200px",border:"1px solid #E3E3E3",marginTop:"2px",padding:"3px 3px"},value:this.state.mimeBody,onChange:e=>this.setState({mimeBody:e.target.value})}))),i.a.createElement(l.Row,{sm:6},i.a.createElement(l.Col,{sm:2,style:{top:"25px"}},"SMS \u0130\xe7erik"),i.a.createElement(l.Col,{sm:6},i.a.createElement(l.Input,{type:"textarea",rows:5,style:{height:"200px",border:"1px solid #E3E3E3",marginTop:"2px",padding:"3px 3px"},value:this.state.smsBody,onChange:e=>this.setState({smsBody:e.target.value})}))))}renderSignProgress(){let e=100*this.state.signedDocumentCount/this.state.progressLength,t=this.state.pdfName&&this.state.pdfName.split("#");return i.a.createElement("div",{className:"FormRenk",style:{paddingRight:"35px"}},i.a.createElement("div",{className:"component-fluid"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12"},"\u0130mzalanan dosya:"),i.a.createElement("div",{className:"col-sm-12"},this.state.pdfName&&i.a.createElement("div",{style:{display:"inline-block",marginRight:"8px"}},i.a.createElement("span",null,t[0]),i.a.createElement("span",{style:{fontWeight:"bold"}},t[1]),i.a.createElement("span",null,t[2]),i.a.createElement("span",{style:{fontWeight:"bold"}},t[3]),i.a.createElement("div",{style:{display:"inline-block",marginRight:"8px",position:"absolute",top:"5px",paddingLeft:"2px"}},i.a.createElement(c.a,{type:"balls",color:"#2c2c2c",height:12,width:12})))),i.a.createElement("div",{className:"col-sm-12"},i.a.createElement(l.Progress,{value:e},"%"+Math.round(e))))))}render(){return i.a.createElement(l.Row,{className:"baseBackground"},i.a.createElement(r.a,{ref:"notify"}),this.state.alert,this.renderNavButtons(),i.a.createElement("div",{className:"row satirBasi"},i.a.createElement(l.Col,{md:"12"},i.a.createElement(l.Card,{className:"card"},i.a.createElement(l.CardHeader,null,i.a.createElement(l.CardTitle,{tag:"h4"},"Form \u0130mzala")),i.a.createElement(l.CardBody,null,this.state.formSessionId&&this.renderState()),i.a.createElement(l.CardBody,null,this.state.formSessionId&&this.renderMimeInputs()),i.a.createElement(l.CardBody,null,this.state.loading&&this.renderSignProgress())))))}}t.default=S}}]);