(this["webpackJsonpportal-react"]=this["webpackJsonpportal-react"]||[]).push([[52],{1627:function(e,t,a){"use strict";a.r(t);var i=a(0),s=a.n(i),l=a(2),n=a(21),r=(a(19),a(5)),o=a(3),c=a(61),d=a.n(c),m=a(81),h=a(312),p=a(599),u=a(203);class g extends i.Component{constructor(){super(),this.state={loading:!1},this.loadCertificatesClicked=this.loadCertificatesClicked.bind(this),this.changed=this.changed.bind(this),this.defaultHsmType="akis",this.axios=d.a.create({baseURL:"http://127.0.0.1:9999"})}componentDidMount(){}loadCertificatesClicked(){let e="/certificate?hsmtype="+(this.props.value&&this.props.value.hsmType||this.defaultHsmType);this.setState({loading:!0,certificateList:null}),this.axios.get(e).then(e=>{let t=e.data.certificate.filter(e=>e.keyUsage.some(e=>"DIGITAL_SIGNATURE"===e));this.setState({certificateList:t}),this.changed("certificate",t[0])}).catch(e=>{this.setState({alert:s.a.createElement(m.a,{error:e,onConfirm:()=>this.setState({alert:null})})})}).finally(()=>{this.setState({loading:!1})})}changed(e,t){let a=Object.assign({},this.props.value);a[e]=t,"hsmType"===e&&(a.certificate=null,this.setState({certificateList:null})),a.hsmType||(a.hsmType=this.defaultHsmType),this.props.onChange&&this.props.onChange(a)}render(){return s.a.createElement(l.Container,null,this.state.alert,s.a.createElement(l.Row,null,s.a.createElement(l.Label,{sm:12,md:3,lg:3},"Ak\u0131ll\u0131 kart markas\u0131"),s.a.createElement(l.Col,{sm:12,md:5,lg:5},s.a.createElement(l.Input,{type:"select",disabled:this.props.disabled,value:this.props.value&&this.props.value.hsmType||this.defaultHsmType,onChange:e=>{this.changed("hsmType",e.target.value)}},[{label:"Akis",value:"akis"},{label:"GemSafe",value:"gemsafe"},{label:"Seimens",value:"seimens"},{label:"StarCOS",value:"starcos"},{label:"Aladdin",value:"aladdin"}].map((e,t)=>s.a.createElement("option",{key:t,value:e.value},e.label)))),s.a.createElement(l.Col,{sm:12,md:4,lg:4},s.a.createElement(h.a,{disabled:this.props.disabled,color:"primary",faIcon:"fa-sync-alt",onClick:this.loadCertificatesClicked,style:{width:"100%"}},"Sertifikalar\u0131 getir"))),s.a.createElement(l.Row,null,this.state.certificateList&&this.props.value&&this.props.value.certificate?this.renderCertificateSelecter():this.renderEmptyCertificateSelector()))}renderCertificateSelecter(){let e={DIGITAL_SIGNATURE:"Dijital imza",NON_REPUDIATION:"Reddedilememe",KEY_ENCIPHERMENT:"Anahtar \u015fifreleme",DATA_ENCIPHERMENT:"Veri \u015fifreleme",KEY_AGREEMENT:"Anahtar anla\u015fmas\u0131",KEY_CERT_SIGN:"Sertifika imzalama",CRL_SIGN:"Sertifia iptal listesi imzalama",ENCIPHER_ONLY:"Sadece \u015fifreleme",DECIPHER_ONLY:"Sadece \xe7\xf6zme"};return s.a.createElement(l.Container,null,s.a.createElement(l.Row,null,s.a.createElement(l.Col,{sm:12},s.a.createElement(l.Input,{type:"select",disabled:this.props.disabled,value:this.props.value.certificate.keyId,onChange:e=>{this.changed("certificate",this.state.certificateList.find(t=>t.keyId===e.target.value))}},this.state.certificateList.map(e=>s.a.createElement("option",{key:e.keyId,value:e.keyId},e.commonName))))),this.props.value&&this.props.value.certificate&&s.a.createElement(l.Container,null,s.a.createElement(l.Row,null,s.a.createElement(l.Col,{sm:12,md:4},s.a.createElement("label",null,"Ortak ad")),s.a.createElement(l.Col,{sm:12,md:8},this.props.value.certificate.commonName)),s.a.createElement(l.Row,null,s.a.createElement(l.Col,{sm:12,md:4},s.a.createElement("label",null,"Seri no")),s.a.createElement(l.Col,{sm:12,md:8},this.props.value.certificate.serial)),s.a.createElement(l.Row,null,s.a.createElement(l.Col,{sm:12,md:4},s.a.createElement("label",null,"Ge\xe7erlilik baslang\u0131c\u0131")),s.a.createElement(l.Col,{sm:12,md:8},this.props.value.certificate.validFrom)),s.a.createElement(l.Row,null,s.a.createElement(l.Col,{sm:12,md:4},s.a.createElement("label",null,"Ge\xe7erlilik sonu")),s.a.createElement(l.Col,{sm:12,md:8},this.props.value.certificate.expiresOn)),s.a.createElement(l.Row,null,s.a.createElement(l.Col,{sm:12,md:4},s.a.createElement("label",null,"Anahtar kullan\u0131m\u0131")),s.a.createElement(l.Col,{sm:12,md:8},s.a.createElement("ul",null,this.props.value.certificate.keyUsage.map((t,a)=>s.a.createElement("li",{key:a},e[t])))))))}renderEmptyCertificateSelector(){return s.a.createElement(l.Col,{sm:12},s.a.createElement("div",{style:{minHeight:"180px",position:"relative"}},!this.state.loading&&s.a.createElement(p.a,{type:"usb",style:{width:"90px",height:"90px"},transparent:!0}),this.state.loading&&s.a.createElement(u.a,{style:{width:"90px",height:"90px"},transparent:!0})))}}var f=g,E=(a(64),a(75)),C=a(6),b=a.n(C);class y extends i.Component{constructor(e){super(e),this.uploadZip=()=>{this.setState({file:null,depo:"GEK"}),document.getElementById("upload-file").value=null,document.getElementById("upload-file").click()},this.downloadZip=()=>{Object(r.e)({url:"/missing-signature/downloadAllZipped",method:"post",responseType:"arraybuffer"}).then(e=>{let t=new Blob([e.data],{type:e.headers["content-type"]}),a=(window.URL||window.webkitURL).createObjectURL(t),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=a,i.download="all.zip",i.click()}).catch(e=>{Object(o.v)(e)})},this.renderPin=()=>{if(this.state.pdfs&&this.state.pdfs.length>0){let e=100*this.state.signedDocumentCount/this.state.progressLength;return s.a.createElement(l.Container,null,s.a.createElement(l.Row,null,s.a.createElement(l.Label,{sm:12,md:3,disabled:!0},"Pin"),s.a.createElement(l.Col,{sm:12,md:5},s.a.createElement(l.Input,{type:"password",autoComplete:"off",disabled:this.state.loading,value:this.state.pin,onChange:e=>{this.setState({pin:e.target.value})}})),s.a.createElement(l.Col,{sm:12,md:4},s.a.createElement(l.Button,{title:"\u0130mzala",color:"success",disabled:this.state.loading||!this.state.pin||this.state.showSigned,style:{position:"relative",width:"50%",height:"30px",marginTop:"-7px",marginLeft:"-5px",padding:"0 5% 0 0",margin:0},onClick:this.signClicked},s.a.createElement("span",{style:{position:"absolute",right:"0px",bottom:0,padding:"11px 10px",height:"30px",background:"rgba(0,0,0,0.15)",borderRadius:"3px 0 0 3px",display:"flex",alignItems:"center"}},s.a.createElement("i",{className:"fa fa-check"})),"\u0130mzala"))),s.a.createElement(l.Row,{style:{marginTop:"1em"}},s.a.createElement("div",{className:"col-sm-12"},s.a.createElement(l.Progress,{value:e},"%"+Math.round(e)))))}},this.signClicked=()=>{let e=Promise.resolve([]),t=this.state.pdfs,a=[];this.setState({progressLength:t.length,loading:!0,showSigned:!0}),t.forEach((t,i)=>{e=e.then(e=>this.axios.post("/signature/signedinfo?hsmtype="+this.state.hsmInput.hsmType,{base64:!0,pin:this.state.pin,signedInfo:t.signedInfo,certificate:{keyId:this.state.hsmInput.certificate.keyId}}).then(e=>{a.push({id:t.id,signature:e.data.signedDocument}),this.writeSignedDoc(a),a=[]}))}),e.then(e=>{this.setState({loading:!1,completed:!0})}).catch(e=>{this.setState({loading:!1,completed:!1,disableButton:!1,alert:s.a.createElement(m.a,{error:e,onConfirm:()=>this.setState({alert:null})})})})},this.writeSignedDoc=e=>{let t=this,a={url:"/missing-signature/writePdfSignatures",method:"post",data:e,timeout:96e5};Object(r.e)(a).then((function(e){t.setState((e,t)=>({signedDocumentCount:e.signedDocumentCount+1}))})).catch((function(e){Object(o.v)(e)}))},this.onFileDrop=e=>{if(!e&&null===e)return;let t=new FormData;t.append("content",e),Object(r.e)({url:"/missing-signature/uploadAllZip",method:"post",data:t}).then(()=>{}).catch(e=>Object(o.v)(e))},this.onChangeHsmInput=e=>{this.setState({hsmInput:e}),e.certificate&&(this.setState({certificate:e.certificate}),this.fetchData(null,null,this.state.page,this.state.size))},this.fetchData=(e,t,a,i)=>{let s=e?"&sort="+e+","+t:"&sort=id,desc";this.setState({loading:!0}),Object(r.e)({url:"/missing-signature/missings?page=".concat(a,"&size=").concat(i).concat(s),method:"post",data:this.state.certificate.keyId}).then(e=>{this.setState({total:e.data.totalElements,pdfs:e.data.content,loading:!1})}).catch(e=>{this.setState({loading:!1}),Object(o.v)(e)})},this.state={pdfs:[],total:0,page:0,size:250,loading:!1,canUpload:!1,certificate:null,showSigned:!1,signedDocumentCount:0,progressLength:1,timer:1,timerStarted:!1}}componentDidMount(){this.axios=d.a.create({baseURL:"http://127.0.0.1:9999"}),Object(r.e)({url:"/missing-signature/can-upload",method:"get"}).then(e=>{this.setState({canUpload:e.data})}).catch(e=>{this.setState({canUpload:!1})})}componentDidUpdate(){1===this.state.timer&&!this.state.timerStarted&&this.state.completed&&this.state.signedDocumentCount===this.state.progressLength?(setInterval(()=>{this.setState(e=>({timer:e.timer-1}))},1e3),this.setState({timerStarted:!0})):0===this.state.timer&&(b.a.success("\u0130mzalama i\u015flemi ba\u015far\u0131l\u0131.",{position:"top-right",effect:"stackslide",timeout:5e3}),this.props.history.push({pathname:"/".concat(this.props.peykName,"/hr-dashboard")}))}renderNavButtons(){return s.a.createElement(l.Nav,{className:"topbar",style:{paddingLeft:"14px",height:"53px"}},this.state.canUpload&&this.props.isSuperAdmin&&s.a.createElement(n.a,{position:"leftSide",className:"zocial Yeni",style:{fontSize:"x-small"},label:"Zip \u0130ndir",title:"Dok\xfcman\u0131 \u0130mzala",onClick:this.downloadZip}),this.state.canUpload&&this.props.isSuperAdmin&&s.a.createElement(n.a,{position:"leftSide",className:"zocial Yeni",style:{fontSize:"x-small"},label:"Zip Yukle",title:"Dok\xfcman\u0131 \u0130mzala",onClick:this.uploadZip}))}render(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"row baseBackground"},this.renderNavButtons(),s.a.createElement("div",{className:"col-sm-12 satirBasi"},this.state.canUpload&&s.a.createElement(l.Form,null,s.a.createElement("input",{type:"file",accept:".zip",style:{display:"none"},id:"upload-file",onChange:e=>{this.onFileDrop(e.target.files[0])}})),s.a.createElement(l.CardHeader,null,s.a.createElement(l.CardTitle,{tag:"h4"})),s.a.createElement(l.CardBody,null,s.a.createElement(f,{value:this.state.hsmInput,disabled:this.state.loading,onChange:this.onChangeHsmInput}),this.renderPin()))),this.state.mediaModal&&s.a.createElement(E.a,{url:this.state.url,modal:this.state.mediaModal,closeModal:()=>this.setState({url:null,mediaModal:!1})}),this.state.alert)}previewContent(e){let t=this,a={url:"/missing-signature/downloadContent?id=".concat(e.id),responseType:"arraybuffer",method:"post"};t.setState({mediaModal:!0}),Object(r.e)(a).then((function(e){let a=new Blob([e.data],{type:e.headers["content-type"]}),i=(window.URL||window.webkitURL).createObjectURL(a);t.setState({url:i})})).catch((function(e){Object(o.v)(e),t.setState({mediaModal:!1,title:null})}))}}t.default=y}}]);