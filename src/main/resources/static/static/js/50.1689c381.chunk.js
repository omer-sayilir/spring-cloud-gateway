(this["webpackJsonpportal-react"]=this["webpackJsonpportal-react"]||[]).push([[50],{1493:function(e,t,a){"use strict";a.r(t);var i=a(0),s=a.n(i),n=a(2),r=(a(92),a(13)),o=a.n(r),l=a(62),m=a.n(l),c=(a(218),a(82),a(60)),p=a.n(c),h=a(80),d=a(175),u=a(38),f=a.n(u),g=a(21),S=a(3),y=a(5),C=a(4);class E extends i.Component{constructor(e){super(e),this.state={loading:!1,completed:!1,signedDocumentCount:0,progressLength:1,pageState:0,timer:1,timerStarted:!1,certError:!0,disableButton:!1},this.signMimes=this.signMimes.bind(this),this.updateMimeInfo=this.updateMimeInfo.bind(this),this.writeSignedMime=this.writeSignedMime.bind(this),this.updateMimeCertificates=this.updateMimeCertificates.bind(this),this.stateMap={0:{label:"\u0130letiler imzalama i\xe7in haz\u0131r. \u0130mzalay\u0131n\u0131z"},10:{label:"\u0130letiler olu\u015fturuluyor. L\xfctfen bekleyiniz.",wait:!0},20:{label:"Sertifika sahibi iletilere yaz\u0131l\u0131yor. L\xfctfen bekleyiniz.",wait:!0},30:{label:"\u0130letiler imzalan\u0131yor. L\xfctfen bekleyiniz"},40:{label:"\u0130letiler imzalanamad\u0131. L\xfctfen bilgileri kontrol ediniz.",danger:!0}}}componentDidMount(){this.axios=p.a.create({baseURL:"http://127.0.0.1:9999"}),this.props&&this.props.location&&this.props.location.formSessionId?this.setState({formSessionId:this.props.location.formSessionId,kepAccountList:this.props.location.kepAccountList,mimeTitle:this.props.location.mimeTitle,mimeBody:this.props.location.mimeBody}):this.props.history.push({pathname:`/${this.props.peykName}/formsessionlist`})}componentDidUpdate(){1===this.state.timer&&!this.state.timerStarted&&this.state.completed&&this.state.signedDocumentCount===this.state.progressLength?(setInterval(()=>{this.setState(e=>({timer:e.timer-1}))},1e3),this.setState({timerStarted:!0})):0===this.state.timer&&this.props.history.push({pathname:`/${this.props.peykName}/formsession/${this.state.formSessionId}`})}updateMimeInfo(){let e=this,t={url:"/signer/writeFormMimeInfo",method:"post",data:{formSessionId:parseInt(e.props.location.formSessionId),kepAccountId:e.state.kepAccountId&&parseInt(e.state.kepAccountId),title:e.state.mimeTitle,body:e.state.mimeBody}};e.setState({pageState:10,alert:null,disableButton:!0}),Object(y.e)(t).then((function(t){e.updateMimeCertificates()})).catch((function(t){Object(S.v)(t),e.setState({pageState:40,disableButton:!1})}))}updateMimeCertificates(){let e=this,t={url:"/formsession/createFormMimeSignedInfoList",method:"post",data:{formSessionId:parseInt(e.state.formSessionId),hsmType:e.state.mimeCertificate.hsmType,certificate:e.state.mimeCertificate.value,certificateKeyId:e.state.mimeCertificate.keyId}};e.setState({pageState:20}),Object(y.e)(t).then((function(t){e.setState({signedInfoList:t.data}),e.signMimes()})).catch((function(t){Object(S.v)(t),e.setState({loading:!1,disableButton:!1})}))}signMimes(){let e=Promise.resolve([]),t=[];this.setState({progressLength:this.state.signedInfoList.length,loading:!0,pageState:30}),this.state.signedInfoList.forEach((a,i)=>{e=e.then(e=>(this.setState({pdfName:a.pdfName}),this.axios.post("/signature/signedinfo?hsmtype="+a.hsmType,{base64:!0,pin:this.state.pin,signedInfo:a.signedInfo,certificate:{keyId:a.certificateKeyId}}).then(e=>{t.push({id:a.id,signature:e.data.signedDocument}),this.writeSignedMime(t),t=[]})))}),e.then(e=>{this.setState({loading:!1,completed:!0})}).catch(e=>{this.setState({loading:!1,completed:!1,disableButton:!1,alert:s.a.createElement(h.a,{error:e,onConfirm:()=>this.setState({alert:null})})})})}writeSignedMime(e){let t=this,a={url:"/formsession/writeFormMimeSignatureList",method:"post",data:e};Object(y.e)(a).then((function(e){t.setState((e,t)=>({signedDocumentCount:e.signedDocumentCount+1}))})).catch((function(e){Object(S.v)(e),t.setState({pageState:40,disableButton:!1})}))}renderNavButtons(){return s.a.createElement(n.Nav,{className:"topbar",style:{paddingLeft:"14px",height:"53px"}},s.a.createElement(g.a,{position:"leftSide",className:"zocial GeriDon",style:{fontSize:"small"},label:"Geri",title:"\xd6nceki Sayfaya Git",onClick:()=>this.props.history.push(`/${this.props.peykName}/formsession/${this.state.formSessionId}`)}),Object(S.f)(this,[C.w,C.E,C.B,C.U,C.G])&&s.a.createElement(g.a,{position:"leftSide",className:"zocial Imza",style:{fontSize:"small"},label:"\u0130mzala",title:"\u0130leti Olu\u015ftur ve \u0130mzala",disabled:this.state.disableButton,onClick:()=>{this.state.mimeCertificate&&this.state.mimeCertificate.hsmType&&this.state.mimeCertificate.value&&this.state.mimeCertificate.keyId?void 0===this.state.kepAccountId?this.setState({alert:s.a.createElement(o.a,{warning:!0,confirmBtnText:"Tamam",confirmBtnBsStyle:"warning",title:"Uyar\u0131",onConfirm:()=>{this.setState({alert:null})}},"Kep hesab\u0131 se\xe7imi yap\u0131n\u0131z.")}):this.setState({alert:s.a.createElement(o.a,{showCancel:!0,warning:!0,confirmBtnText:"Evet",cancelBtnText:"Hay\u0131r",confirmBtnBsStyle:"danger",cancelBtnBsStyle:"default",title:"Emin misiniz?",onConfirm:this.updateMimeInfo,onCancel:()=>this.setState({alert:null})},"\u0130letiler imzalanacak.")}):this.setState({alert:s.a.createElement(h.a,{error:this.state.certError,onConfirm:()=>this.setState({alert:null})})})}}))}renderState(){let e=this.stateMap[this.state.pageState];return s.a.createElement("div",{className:"row",style:{marginBottom:"15px"}},s.a.createElement(n.Col,{sm:12},s.a.createElement("div",{style:{display:"inline-block",marginRight:"8px"}},e.wait&&s.a.createElement(f.a,{type:"balls",color:"#2c2c2c",height:24,width:24})),s.a.createElement("div",{style:{display:"inline-block",marginRight:"8px",position:"relative",top:"-6px",color:!0===e.danger?"trueColor":"falseColor"}},e.label)))}renderMimeInputs(){return s.a.createElement("div",{className:"FormRenk"},s.a.createElement(n.Row,{sm:6},s.a.createElement(n.Col,{sm:2,style:{top:"7px"}},"Kep Hesab\u0131"),s.a.createElement(n.Col,{sm:6},this.state.kepAccountList&&s.a.createElement(n.Input,{type:"select",value:this.state.kepAccountId,disabled:0!==this.state.pageState,onChange:e=>this.setState({kepAccountId:e.target.value})},[s.a.createElement("option",{key:"0",value:""},"Se\xe7iniz"),...this.state.kepAccountList.map(e=>s.a.createElement("option",{key:e.id,value:e.id},e.account))]),!this.state.kepAccountList&&s.a.createElement(n.Input,{type:"select",value:this.state.kepAccountId,onChange:e=>this.setState({kepAccountId:e.target.value})},[s.a.createElement("option",{key:"0",value:""},"Se\xe7iniz")]))),s.a.createElement(n.Row,{sm:6},s.a.createElement(n.Col,{sm:2,style:{top:"5px"}},"Kep Konu"),s.a.createElement(n.Col,{sm:6},s.a.createElement(n.Input,{type:"text",style:{marginTop:"2px"},disabled:0!==this.state.pageState,value:this.state.mimeTitle,onChange:e=>this.setState({mimeTitle:e.target.value})}))),s.a.createElement(n.Row,{sm:6},s.a.createElement(n.Col,{sm:2,style:{top:"25px"}},"Kep \u0130\xe7erik"),s.a.createElement(n.Col,{sm:6},s.a.createElement(n.Input,{type:"textarea",rows:5,disabled:0!==this.state.pageState,style:{height:"200px",border:"1px solid #E3E3E3",marginTop:"2px",padding:"3px 3px"},value:this.state.mimeBody,onChange:e=>this.setState({mimeBody:e.target.value})}))))}render(){return s.a.createElement(n.Row,{className:"baseBackground"},s.a.createElement(m.a,{ref:"notify"}),this.state.alert,this.renderNavButtons(),s.a.createElement("div",{className:"row satirBasi"},s.a.createElement(n.Col,{md:"12"},s.a.createElement(n.Card,{className:"card"},s.a.createElement(n.CardHeader,null,s.a.createElement(n.CardTitle,{tag:"h4"},"\u0130mzala & G\xf6nder")),s.a.createElement(n.CardBody,null,this.props.location.formSessionId&&this.renderState()),s.a.createElement(n.CardBody,null,this.props.location.formSessionId&&this.renderMimeInputs()),s.a.createElement(n.CardBody,null,this.props.location.formSessionId&&s.a.createElement(d.a,{value:this.state.mimeCertificate,onChange:e=>this.setState({mimeCertificate:e}),pinValueChange:e=>this.setState({pin:e}),certificateError:e=>this.setState({certError:e}),pdfName:this.state.pdfName?this.state.pdfName:"",progressLength:this.state.progressLength,signedDocumentCount:this.state.signedDocumentCount,displayCertificateMenu:0===this.state.pageState||40===this.state.pageState,userId:this.props.currentUser&&this.props.currentUser.id}))))))}}t.default=E}}]);
//# sourceMappingURL=50.1689c381.chunk.js.map